# 高德地图集成说明

## 功能介绍

已成功集成高德地图API，提供以下功能：
- 显示交互式地图
- 自动获取用户当前位置
- 在地图上标记用户位置
- 显示详细的位置信息（经纬度、城市、地址）
- 支持刷新定位功能

## 配置步骤

### 1. 获取高德地图 API Key

1. 访问高德开放平台：https://console.amap.com/
2. 注册/登录账号
3. 进入"应用管理" -> "我的应用"
4. 创建新应用（如果还没有）
5. 添加 Key：
   - 名称：随意填写（如：个人管理系统）
   - 服务平台：选择 "Web端(JS API)"
   - 白名单：开发环境可以不填，生产环境建议填写域名

### 2. 配置环境变量

在 `frontend` 目录下创建 `.env` 文件（或复制 `.env.example`）：

```bash
cd frontend
cp .env.example .env
```

编辑 `.env` 文件，填入你的 API Key：

```env
VITE_API_BASE=http://127.0.0.1:8001
VITE_AMAP_KEY=你的高德地图API_Key
```

### 3. 重启前端服务

修改环境变量后需要重启前端开发服务器：

```bash
# 停止当前服务（Ctrl+C）
# 重新启动
npm run dev
```

## 使用说明

### 访问地图功能

1. 登录系统
2. 点击左侧菜单的"地图定位"
3. 点击"初始化地图"按钮
4. 浏览器会请求定位权限，点击"允许"
5. 地图会自动定位到你的当前位置

### 功能按钮

- **初始化地图**：首次加载地图（只需点击一次）
- **刷新定位**：重新获取当前位置

### 位置信息显示

地图上方会显示：
- 经度：精确到小数点后6位
- 纬度：精确到小数点后6位
- 城市：当前所在城市
- 详细地址：完整的地址信息

### 地图交互

- 拖动：移动地图
- 滚轮：缩放地图
- 双击：放大地图
- 标记点：显示你的当前位置

## 常见问题

### 1. 地图加载失败

**原因**：
- API Key 未配置或配置错误
- 网络连接问题
- API Key 配额用完

**解决方法**：
- 检查 `.env` 文件中的 `VITE_AMAP_KEY` 是否正确
- 确认网络可以访问高德地图服务
- 登录高德控制台查看 API 调用量

### 2. 定位失败

**原因**：
- 浏览器未授权定位权限
- 使用 HTTP 协议（部分浏览器要求 HTTPS）
- 设备不支持定位

**解决方法**：
- 在浏览器地址栏左侧点击锁图标，允许定位权限
- 开发环境使用 `localhost` 或 `127.0.0.1`
- 生产环境使用 HTTPS 协议

### 3. 地图显示空白

**原因**：
- 容器高度未设置
- CSS 样式冲突

**解决方法**：
- 已在代码中设置固定高度 600px
- 检查浏览器控制台是否有错误信息

### 4. API Key 配额限制

高德地图免费版限制：
- 每日调用量：30万次
- 并发量：300次/秒

如果超出限制，需要：
- 升级为付费版
- 或优化调用频率

## 技术细节

### 使用的高德地图 API

- **JS API 2.0**：最新版本的 Web 地图 API
- **Geolocation 插件**：用于获取用户位置
- **Marker**：地图标记
- **InfoWindow**：信息窗体

### 代码结构

```
frontend/src/App.vue
├── 状态管理
│   ├── mapLoaded: 地图是否已加载
│   ├── mapInstance: 地图实例
│   ├── userLocation: 用户位置信息
│   ├── locationError: 定位错误信息
│   └── mapMarker: 地图标记
├── 函数
│   ├── loadAmapScript(): 动态加载高德地图脚本
│   ├── initMap(): 初始化地图
│   ├── getUserLocation(): 获取用户位置
│   └── refreshLocation(): 刷新定位
└── 模板
    └── 地图容器 (#amap-container)
```

### 样式说明

- `.map-wrapper`: 地图外层容器
- `.map-container`: 地图显示区域（600px高度）
- `.location-info`: 位置信息卡片网格
- `.info-card`: 单个信息卡片
- `.map-placeholder`: 地图未加载时的占位符

## 扩展功能建议

可以进一步添加的功能：

1. **路径规划**：添加起点终点，规划路线
2. **周边搜索**：搜索附近的餐厅、商店等
3. **地址搜索**：输入地址进行搜索定位
4. **多点标记**：在地图上标记多个位置
5. **轨迹回放**：记录并回放移动轨迹
6. **地图样式**：切换不同的地图主题
7. **测距工具**：测量两点之间的距离
8. **位置分享**：生成位置链接分享给他人

## 参考文档

- 高德开放平台：https://lbs.amap.com/
- JS API 2.0 文档：https://lbs.amap.com/api/jsapi-v2/summary
- 示例中心：https://lbs.amap.com/demo/jsapi-v2/example/map/map-show
- API Key 申请：https://console.amap.com/dev/key/app
